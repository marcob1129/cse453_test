<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>GPS Map</title>

    <link rel="stylesheet" href="/static/leaflet.css">
    <script src="/static/leaflet.js"></script>
    <script src="/static/socket.io.min.js"></script>

    <style>
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-color: white;
        }

        #map {
            width: 100vw;
            height: 100vh;
            margin: 0;
            padding: 0;
            background-color: white;
        }
    </style>
</head>
<body>

<div id="map"></div>

<div id="controls">
    <input type="text" id="msgInput" placeholder="COME BACK TO BASE">
    <button onclick="sendMessage()">Send</button>
</div>

<script>
    var map = L.map("map", {
        zoomControl: true,
        attributionControl: false
    });

    function sendMessage() {
        var msg = document.getElementById("msgInput").value;

        if (!msg) return;

        socket.emit("send_message", {
            text: msg
        });

        document.getElementById("msgInput").value = "";
    }

    //southwest, northeast
    var imageBounds = [
        [43.00393007104246, -78.77869348098584],
        [42.99696023197851, -78.79764062766652]
    ];

    L.imageOverlay("/static/map.png", imageBounds).addTo(map);
    map.fitBounds(imageBounds);

    var marker = L.circleMarker([43.0018, -78.7895], {
        color: 'blue',
        fillColor: '#30f',
        fillOpacity: 0.8,
        radius: 10,
        weight: 2
    }).addTo(map);

    var path = L.polyline([], {
        color: "red",
        weight: 3
    }).addTo(map);

    var socket = io();

    socket.on("gps_update", function(data) {
        var latlng = [data.lat, data.lon];
        marker.setLatLng(latlng);
        path.addLatLng(latlng);
    });
</script>

</body>
</html>